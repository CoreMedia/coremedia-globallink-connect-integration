#!/usr/bin/env node

/*
 * This is a workaround for the limitation of the Docusaurus Remark plugin
 * `transformLinks` that by intention ignores certain files, including
 * `*.html` files.
 *
 * We require these files though, as they are auto-generated by the Maven
 * license plugin. As a workaround we copy them manually during the build
 * process.
 *
 * Note, that these files are therefore unavailable for a non-production
 * build (like for `docusaurus start`). Instead, to test, you need to first
 * build the site (`docusaurus build`) and then serve it (`docusaurus serve`).
 */
import * as fs from 'fs';
import * as path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const websiteDir = path.resolve(__dirname, '..');
const buildDir = path.join(websiteDir, 'build');

// Define source and destination paths
const copyPaths = [
  {
    source: path.join(websiteDir, 'docs/third-party/files'),
    dest: path.join(buildDir, 'third-party/files')
  }
];

console.log('Copying HTML files...');

copyPaths.forEach(({ source, dest }) => {
  if (fs.existsSync(source)) {
    // Create destination directory if it doesn't exist
    fs.mkdirSync(dest, { recursive: true });

    // Read all files in source directory
    const files = fs.readdirSync(source);

    // Copy only HTML files
    const htmlFiles = files.filter(file => file.endsWith('.html'));

    htmlFiles.forEach(file => {
      const sourcePath = path.join(source, file);
      const destPath = path.join(dest, file);

      try {
        fs.copyFileSync(sourcePath, destPath);
        console.log(`✓ Copied: ${file} to ${path.relative(buildDir, dest)}/`);
      } catch (error) {
        console.error(`✗ Failed to copy ${file}:`, error.message);
      }
    });

    if (htmlFiles.length === 0) {
      console.log(`ℹ No HTML files found in ${path.relative(websiteDir, source)}`);
    }
  } else {
    console.log(`ℹ Source directory not found: ${path.relative(websiteDir, source)}`);
  }
});

console.log('HTML file copying completed.');
